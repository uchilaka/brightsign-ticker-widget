<!DOCTYPE html>
<html>

<body>
  <div id="ticker_output">No ticker deployed</div>
  <script type="text/javascript">
    // The JavaScript code
    var tickerDisplay = document.querySelector('#ticker_output');

    function updateTickerInfo(ticker) {
      // @TODO some more sophisticated formatting
      // @TODO probably best to do this all with react?
      tickerDisplay.innerHTML = ticker.symbol + " " + ticker.price;
      // tickerDisplay.innerHTML = `
      //   ${ticker.symbol} ${ticker.price}
      // `;
    }

    tickerDisplay.innerHTML = "We deployed a ticker";

    // // Using the fake API
    // fetch("https://brightsign-ticker-api.herokuapp.com/stocks?symbol=ADS", { "Content-Type": "application/json" })
    //   .then(function (response) {
    //     console.log("Result -> ", response)
    //     return response.json();
    //   })
    //   .then(function (data) {
    //     console.log("Data -> ", data);
    //     // Test to make sure you have an array
    //     if (Array.isArray(data) && data.length) {
    //       // Update the ticker data for the result to the UI with the helper function
    //       updateTickerInfo(data[0]);
    //     }
    //   })
    //   .catch(function (err) {
    //     console.error("Request failed :(")
    //   });

    // Using the live (alpha-vantage) API
    fetch("https://brightsign-ticker-api.herokuapp.com/live/ADS", { "Content-Type": "application/json" })
      .then(function (response) {
        console.log("Result -> ", response)
        return response.json();
      })
      .then(function (data) {
        console.log("Data -> ", data);
        // Formatting
        var fields = {
          "01. symbol": "symbol",
          "05. price": "price",
          "09. change": "change"
        };
        var arrayOfFields = Object.keys(fields);
        var packet = {};
        for (var i = 0; i < arrayOfFields.length; i++) {
          const field = fields[arrayOfFields[i]];
          packet[field] = data["Global Quote"][arrayOfFields[i]];
        }
        if (packet.price)
          packet.price = parseFloat(packet.price);
        packet.change = packet.change ? parseFloat(packet.change) : 0;
        console.log("Packet -> ", packet);
        // Test to make sure you have an array
        updateTickerInfo(packet);
      })
      .catch(function (err) {
        console.error("Request failed :(")
      });    
  </script>
</body>

</html>